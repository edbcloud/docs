---
title: "Audit Log Archiving"
---

<div id="audit_log_archiving" class="registered_link"></div>

EDB Audit Log Archiving enables database administrators to control the space consumed by the audit log directory and help manage the audit log files. 
The Audit Archiver is responsible for compression, removal, and execution of log files with `edb_audit_archiver_filename_prefix` present in audit directory. The `edb_audit_archiver_timeout` parameter triggers the compression or expiration of audit log files at appropriate time. For more information about audit logging configuration parameters, see [Audit Logging Configuration Parameters](01_audit_logging_configuration_parameters).

The EDB Audit Archiver helps to:

1. Prepare the list of log files from audit log directory for compression.
2. Determine the log files for compression based on the parameters `edb_audit_archiver_compress_time_limit` and `edb_audit_archiver_compress_size_limit`. 
3. Perform compression of the log files by specifying compression command based on the `edb_audit_archiver_compress_command` parameter.
4. Determine the log files to be removed based on the `edb_audit_archiver_expire_time_limit` and `edb_audit_archiver_expire_size_limit` parameter. 
5. Execute the expiration command specified in the `edb_audit_archiver_expire_command` parameter to remove the log files.

You can set the file rotation day when the new file will be created by setting the parameter `edb_audit_rotation_day` to the desired value to rotate out the older audit log files. The audit log records are overwritten based on FIFO (First-In-First-Out) in the event of unavailability of space for more audit log records.

The following steps describe how to configure Advanced Server to enable compression and expiration of the log files.

-  Enable audit log archiving by setting the `edb_audit_archiver` parameter to `on` in the `postgresql.conf` file.
-  To enable compression of log files, set the parameter, `edb_audit_archiver_compress_size_limit` and `edb_audit_archiver_compress_time_limit` to a desired value.
-  To enable expiration of log files, set the parameter `edb_audit_archiver_expire_size_limit` and `edb_audit_archiver_expire_time_limit` to a desired value. 
-  To enable both compression and expiration, set the parameter, `edb_audit_archiver_compress_size_limit`, `edb_audit_archiver_compress_time_limit`, `edb_audit_archiver_expire_size_limit`, `edb_audit_archiver_expire_time_limit`, and `edb_audit_archiver_expire_command` to a desired value.

The setting of the `edb_audit_archiver` parameter in the configuration file affects the entire database cluster. The database cluster is established with `edb_audit_archiver` set to `on` as shown in its `postgresql.conf` file. The audit log file is generated in csv format depending upon the setting of the `edb_audit` configuration parameter.

```text
logging_collector = 'on'
edb_audit = 'csv'
edb_audit_archiver = 'on'  # (Change requires restart)
```

**Example 1**

The following is an example where `edb_audit_archiver`, `edb_audit_archiver_compress_size_limit`, and `edb_audit_archiver_compress_time_limit` are set to compress the audit log files greater than 10MB.

```text
edb_audit_archiver = 'on'
edb_audit_archiver_compress_size_limit = 10
edb_audit_archiver_compress_time_limit = 0
```

Before compressing the log files, the resulting audit log file appears as following:

```text
-rw-------. 1 edb edb 1755 Jun 4 02:34 audit-20210604_021622.csv   <== Shows non-compressed audit log files 
-rw-------. 1 edb edb 1473 Jun 4 02:40 audit-20210604_023429.csv
-rw-------. 1 edb edb 2479 Jun 4 02:46 audit-20210604_024016.csv
-rw-------. 1 edb edb 2490 Jun 4 02:50 audit-20210604_024021.csv
```

The `edb_audit_archiver` parameter checks the audit log files excluding the latest file and retains at least 10MB of log files in the audit log directory and compresses the remaining log files. After compression of the log files, the resulting audit log file appears as following:

```text
-rw-------. 1 edb edb 1755 Jun 4 02:34 audit-20210604_021622.csv.gz   <== Shows compressed audit log files 
-rw-------. 1 edb edb 1473 Jun 4 02:40 audit-20210604_023429.csv.gz
-rw-------. 1 edb edb 2479 Jun 4 02:46 audit-20210604_024016.csv.gz
-rw-------. 1 edb edb 2490 Jun 4 02:50 audit-20210604_024021.csv      <== Shows non-compressed audit log files 
```

**Example 2**

The following is an example where `edb_audit_archiver`, `edb_audit_archiver_expire_size_limit`, and `edb_audit_archiver_expire_time_limit` are set to perform expiration of the audit log files older than one hour.

```text
edb_audit_archiver = 'on'
edb_audit_archiver_expire_size_limit = 0
edb_audit_archiver_expire_time_limit = 3600
```

Before compressing the log files, the resulting audit log file appears as following:

```text
-rw-------. 1 edb edb 2097367 Jun 4 03:23 audit-20200811_132352.csv   <== Shows non-compressed audit log files scheduled for expiration/removal
-rw-------. 1 edb edb 2097395 Jun 4 03:24 audit-20200811_132353.csv   <== Shows non-compressed audit log files scheduled for expiration/removal
-rw-------. 1 edb edb 2097367 Jun 4 03:23 audit-20200811_132354.csv
-rw-------. 1 edb edb 2097367 Jun 4 03:28 audit-20200811_132356.csv
```

The `edb_audit_archiver` parameter checks the audit log files excluding the latest file and removes the log files older than one hour. After expiration of the log files, the resulting audit log file appears as following:

```text
-rw-------. 1 edb edb 2097367 Jun 4 03:23 audit-20200811_132354.csv
-rw-------. 1 edb edb 2097367 Jun 4 03:28 audit-20200811_132356.csv
```

**Example 3**

The following is an example where `edb_audit_archiver`, `edb_audit_archiver_compress_size_limit`, `edb_audit_archiver_compress_time_limit`, `edb_audit_archiver_expire_size_limit`, `edb_audit_archiver_expire_time_limit`, and `edb_audit_archiver_expire_command` are set to perform both compression and expiration of the audit log files.

```text
edb_audit_archiver = 'on'
edb_audit_archiver_compress_size_limit = 4
edb_audit_archiver_compress_time_limit = 0
edb_audit_archiver_expire_size_limit = 5
edb_audit_archiver_expire_time_limit = 0
edb_audit_archiver_expire_command = 'cp %p /home/edb_audit/backup-log/'
```

Before compressing the log files, the resulting audit log file appears as following:

```text
-rw-------. 1 edb edb 2097522 Jun 4 13:02 audit-20200811_125816.csv   <== Shows non-compressed audit log files
-rw-------. 1 edb edb 2097510 Jun 4 13:02 audit-20200811_130215.csv
-rw-------. 1 edb edb 2097336 Jun 4 13:10 audit-20200811_130947.csv
-rw-------. 1 edb edb 2097276 Jun 4 13:10 audit-20200811_131024.csv
-rw-------. 1 sysdba users 2097215 Aug 11 13:10 audit-20200811_131025.csv
-rw-------. 1 sysdba users 2097152 Aug 11 13:10 audit-20200811_131026.csv
-rw-------. 1 sysdba users 2097270 Aug 11 13:10 audit-20200811_131028.csv
```

The `edb_audit_archiver` parameter checks the audit log files excluding the latest file and retains at least 4MB of log files in the audit log directory and compresses the remaining log files. During checking the log files for expiration, `edb_audit_archiver` retains at least 5MB of log files in the audit log directory and removes the remaining log files.

```text
-rw-------. 1 sysdba users   63854 Aug 11 13:10 audit-20200811_131034.csv.gz
-rw-------. 1 sysdba users   63513 Aug 11 13:10 audit-20200811_131035.csv.gz
-rw-------. 1 sysdba users   63738 Aug 11 13:10 audit-20200811_131036.csv.gz
-rw-------. 1 sysdba users   63708 Aug 11 13:10 audit-20200811_131037.csv.gz
-rw-------. 1 sysdba users 2097388 Aug 11 13:10 audit-20200811_131051.csv
-rw-------. 1 sysdba users 2097359 Aug 11 13:10 audit-20200811_131052.csv
```

The expiration command is specified as `edb_audit_archiver_expire_command = 'cp %p /home/edb_audit/backup-log/'` in the `postgresql.conf` file, the `edb_audit_archiver` executes this command and copies the log files to a backup log directory before deleting them from the audit log directory.

```text
-rw-------. 1 sysdba users 2097522 Aug 11 13:02 audit-20200811_125816.csv.gz
-rw-------. 1 sysdba users 2097510 Aug 11 13:02 audit-20200811_130215.csv.gz
-rw-------. 1 sysdba users 2097336 Aug 11 13:10 audit-20200811_130947.csv.gz
-rw-------. 1 sysdba users 2097276 Aug 11 13:10 audit-20200811_131024.csv.gz
```